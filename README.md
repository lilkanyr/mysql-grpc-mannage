# MySQL-gRPC 数据库管理系统

> 一个基于 gRPC 和 MySQL 的简单数据库管理工具，实现了连接池、事务管理等功能。

## 👀 预览

```bash
$ ./grpc_client
=== 数据库操作菜单 ===
1. 插入用户信息
2. 更新用户信息
3. 删除用户信息
0. 退出程序
请输入您的选择: 

- 基于 gRPC 的客户端-服务器架构
- 高效的 MySQL 连接池管理
- 智能的连接保活机制
- 完整的事务支持
- 中文友好的用户界面
- 强大的错误处理和日志记录

## 系统架构

### 核心组件

1. **连接池管理器 (mysqlDao)**
   - 自动管理数据库连接池
   - 智能的连接保活机制
   - 自动重连和错误恢复
   - 事务支持和查询资源管理

2. **数据库管理器 (mysqlMgr)**
   - 封装数据库操作接口
   - 事务管理
   - 预处理语句支持
   - 自动资源清理

3. **配置管理器 (configMgr)**
   - 集中化配置管理
   - INI 文件支持
   - 运行时配置访问

4. **gRPC 服务 (grpc_server)**
   - 处理客户端请求
   - 操作日志记录
   - 错误处理和状态报告

5. **客户端应用 (grpc_client)**
   - 用户友好的命令行界面
   - 完整的操作菜单
   - 错误处理和状态显示

## 主要功能

- 用户信息管理
  - 插入用户记录
  - 更新用户信息
  - 删除用户记录

## 技术特性

### 连接池管理
- 自动连接池大小管理
- 定期连接保活检查
- 失效连接自动重连
- 连接复用优化

### 事务处理
- ACID 事务支持
- 自动事务回滚
- 预处理语句支持
- 查询资源自动释放

### 错误处理
- 完整的异常捕获
- 详细的错误日志
- 优雅的错误恢复
- 用户友好的错误提示

## 配置说明

配置文件 `config.ini` 包含以下主要设置：

```ini
[mysql]
host=localhost    # 数据库主机地址
port=3306         # 数据库端口
user=root         # 数据库用户名
password=******   # 数据库密码
database=test     # 数据库名称
```

## 构建和运行

### 依赖要求
- CMake 3.10+
- gRPC
- MySQL Connector/C++
- C++17 兼容的编译器

### 构建步骤

```bash
# 快速开始
git clone https://github.com/lilkanyr/mysql-grpc-mannage.git
cd mysql-grpc-mannage
mkdir build && cd build
cmake .. && make

# 配置数据库
cp ../config.ini.example config.ini
vim config.ini  # 修改数据库配置

# 启动服务
./grpc_server  # 新开一个终端
./grpc_client  # 在另一个终端运行
```

2. 运行客户端：
```bash
./grpc_client
```

## 性能优化

- 连接池自动扩缩容
- 预处理语句重用
- 智能的资源管理
- 异步操作支持

## 错误码说明

| 错误类型 | 说明 | 处理方式 |
|---------|------|---------|
| 连接失败 | 无法连接到数据库 | 自动重试，最多3次 |
| 查询超时 | 查询执行超时 | 自动重试或报错 |
| 保活失败 | 连接保活检查失败 | 尝试重新建立连接 |

## 📝 TODO

- [ ] 添加单元测试
- [ ] 实现连接池动态扩容
- [ ] 添加更多数据库操作功能
- [ ] 优化错误处理机制
- [ ] 实现异步查询支持
